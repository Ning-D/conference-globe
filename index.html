<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Conference Globe üåè</title>
  <style>
    html, body { margin: 0; overflow: hidden; background: black; }
    #globeViz { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    #infoPanel {
      position: absolute; top: 60px; right: 40px; width: 320px; padding: 15px;
      background: rgba(20, 20, 20, 0.7); color: white;
      border-radius: 15px; backdrop-filter: blur(8px);
      font-family: 'Segoe UI', sans-serif;
      display: none; box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    #infoPanel img, #infoPanel video {
      width: 100%; border-radius: 10px; margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="globeViz"></div>
  <div id="infoPanel">
    <h2 id="title"></h2>
    <p id="desc"></p>
    <img id="photo" src="">
    <video id="video" controls></video>
  </div>

  <!-- Three.js & Globe.gl -->
  <script src="https://unpkg.com/three@0.157.0/build/three.min.js"></script>
  <script src="https://unpkg.com/globe.gl@2.32.3/dist/globe.gl.min.js"></script>

  <!-- SheetJS for Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script>
  // ‚úÖ Excel Êñá‰ª∂ÔºàGitHub Raw ÁâàÊú¨Ôºâ
  const xlsxUrl = 'https://raw.githubusercontent.com/Ning-D/conference-globe/main/conference_points.xlsx';

  fetch(xlsxUrl)
    .then(res => res.arrayBuffer())
    .then(ab => {
      const workbook = XLSX.read(ab, { type: 'array' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const data = XLSX.utils.sheet_to_json(worksheet);

      // === üåè ÊûÑÂª∫Âú∞ÁêÉ ===
      const globe = Globe()
        (document.getElementById('globeViz'))
        .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
        .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
        .pointAltitude(0.03)
        .pointColor(() => 'rgba(255,180,80,0.9)')
        .pointRadius(0.6)
        .showAtmosphere(true)
        .atmosphereColor('#00ffff')
        .atmosphereAltitude(0.2)
        .pointsData(data);

      // üí° === Âä†‰∏äÂÖâÁÖß ===
      const scene = globe.scene();
      const ambientLight = new THREE.AmbientLight(0xffffff, 1.2);  // ÂÖ®Â±ÄÊüîÂÖâ
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8); // Ê®°ÊãüÈò≥ÂÖâ
      directionalLight.position.set(5, 3, 5);
      scene.add(directionalLight);


      // ÂàùÂßãËßÜËßí
      globe.pointOfView({ lat: 20, lng: 120, altitude: 2 });

      // === ü™© ÁÇπÂáªÁÇπÔºöÈ£ûË°åÂà∞ÂüéÂ∏ÇÂÜÖÈÉ®ËßÜËßí ===
      globe.onPointClick(point => {
        const camera = globe.camera();
        const currentPOV = globe.pointOfView();

        // === 1Ô∏è‚É£ ÊãâËøúÂú∞ÁêÉÔºàÂáÜÂ§áÈ£ûË°åÔºâ
        globe.pointOfView({ lat: currentPOV.lat, lng: currentPOV.lng, altitude: 6 }, 1000);

        // === 2Ô∏è‚É£ È£ûÂà∞ÁõÆÊ†áÂüéÂ∏Ç‰∏äÁ©∫
        setTimeout(() => {
          globe.pointOfView({ lat: point.lat, lng: point.lng, altitude: 1.8 }, 1800);
        }, 1000);

        // === 3Ô∏è‚É£ Ê∑±ÂÖ•ÂüéÂ∏ÇËøëÂú∞ËßÜËßí
        setTimeout(() => {
          globe.showAtmosphere(false); // ÂèØÈÄâÔºöÈöêËóèÂ§ßÊ∞îÂ±Ç‰ª•Ëé∑ÂæóÊõ¥Ê∏ÖÊô∞ËßÜÈáé
          const targetPOV = { lat: point.lat, lng: point.lng, altitude: 0.25 };
          globe.pointOfView(targetPOV, 2500);

          // Ê∑ªÂä†ËΩªÂæÆ‰ª∞ËßÜËßíÔºåÊ®°Êãü‚ÄúËøõÂÖ•ÂüéÂ∏Ç‚Äù
          setTimeout(() => {
            camera.rotation.x = 0.35; // Ë∞ÉÊï¥‰ª∞Ëßí
            camera.rotation.y = 0.0;
            camera.rotation.z = 0.0;
          }, 2400);
        }, 2800);

        // === üåü ÁÇπÂáªÁÇπÈó™ÁÉÅÂä®Áîª
        globe.pointRadius(p => p === point ? 1.2 : 0.6);
        setTimeout(() => globe.pointRadius(() => 0.6), 1200);

        // === üìã Êõ¥Êñ∞Âè≥‰æß‰ø°ÊÅØÈù¢Êùø
        const panel = document.getElementById("infoPanel");
        document.getElementById("title").innerText = point.name || "Unnamed";
        document.getElementById("desc").innerText = point.desc || "";
        document.getElementById("photo").src = point.photo || "";
        document.getElementById("video").src = point.video || "";
        panel.style.display = "block";
      });

      // === üåê Âú∞ÁêÉÁºìÊÖ¢Ëá™ËΩ¨ ===
      globe.controls().autoRotate = true;
      globe.controls().autoRotateSpeed = 0.4;

      // === üå´Ô∏è ÂèØÈÄâÔºöÂú∞Èù¢ÈõæÊÑüÂ¢ûÂº∫Ê∑±Â∫¶ÊïàÊûú ===
      // const scene = globe.scene();
      // scene.fog = new THREE.FogExp2(0x000000, 0.15);
    })
    .catch(err => console.error("‚ùå ËΩΩÂÖ• Excel Â§±Ë¥•:", err));
  </script>
</body>
</html>
